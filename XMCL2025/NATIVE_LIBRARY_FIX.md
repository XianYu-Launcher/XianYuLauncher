# 原生库筛选逻辑修复说明

## 已修复的问题

### 1. 原生库分类器占位符处理
- **问题**：有些原生库分类器包含 `${arch}` 等占位符，导致无法正确匹配
- **修复**：在 `GetNativeClassifier` 方法中添加占位符替换逻辑，将 `${arch}` 替换为当前系统架构（x64/x86）

### 2. 操作系统和架构检测
- **问题**：硬编码的操作系统名称和架构，缺乏灵活性
- **修复**：
  - 操作系统名称仍为 "windows"（适用于当前需求）
  - 架构自动检测为 x64（64位系统）或 x86（32位系统）

### 3. 文件类型提取限制
- **问题**：仅提取 `.dll` 文件，可能忽略其他必要的原生文件
- **修复**：扩展提取的文件类型，包括 `.dll`、`.so` 和 `.dylib`

### 4. 规则检查改进
- **问题**：字符串比较不区分大小写，可能导致规则匹配失败
- **修复**：使用 `StringComparison.OrdinalIgnoreCase` 进行不区分大小写的比较

### 5. 错误日志和调试信息
- **问题**：缺乏调试信息，难以排查问题
- **修复**：
  - 记录缺失的原生库文件路径
  - 记录提取的原生库文件数量
  - 记录提取过程中的错误信息

## 测试步骤

1. **重新构建项目**：确保项目已成功构建（已完成）
2. **运行应用程序**：启动 XMCL2025 应用程序
3. **下载 Minecraft 版本**：选择一个版本进行下载
4. **检查 natives 目录**：
   - 路径：`%localappdata%\Packages\Microsoft.MinecraftUWP_8wekyb3d8bbwe\LocalState\versions\[版本ID]\[版本ID]-natives`
   - 应该包含多个 `.dll` 文件
5. **启动游戏**：尝试启动下载的版本，检查是否能正常加载原生库

## 调试信息查看

如果问题仍然存在，可以通过以下方式查看调试信息：
1. 在 Visual Studio 中运行应用程序并查看输出窗口
2. 或者查看应用程序的日志文件（如果有）

调试信息将包含：
- 找到的原生库文件数量
- 缺失的原生库文件路径
- 提取过程中的任何错误信息

## 预期结果

修复后，"版本ID-natives" 文件夹应该包含从原生库 JAR 文件中提取的 `.dll` 文件，游戏应该能够正常加载这些原生库。